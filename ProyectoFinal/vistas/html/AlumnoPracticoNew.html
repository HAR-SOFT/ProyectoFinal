<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="../css/bootstrap1.css">
        <link rel="stylesheet" href="../css/bootstrap.min.css.map">
        <link rel="stylesheet" href="../css/bootstrap.min.css">
        <link rel="stylesheet" href="../css/formas.css">
        <script src="../js/jquery-1.12.4.js"></script>
        <script src="../js/jquery-ui.js"></script>

        <style>
            .draggable { width: 90px; height: 80px; padding: 0px; float: left; margin: 20px 20px 10px  40px; font-size: .9em; }
            .draggableAgregacion { width: 500px; height: 250px; padding: 5px; float: left; margin: 20px 20px 10px  40px; font-size: .9em; }
            .ui-widget-header p, .ui-widget-content input{ margin: 10px 0px 0px 0px; }
            #snaptarget { height: 1000px; width: 1200px;}
        </style>
        <script>
            $(function () {
                $("#agregacion").draggable({snap: ".ui-widget-header", snapMode: "outer"});
                $("#entidad1").draggable({snap: ".ui-widget-header", snapMode: "outer"});
                $("#entidad2").draggable({snap: ".ui-widget-header", snapMode: "outer"});
                $("#entidad3").draggable({snap: ".ui-widget-header", snapMode: "outer"});
                $("#entidad4").draggable({snap: ".ui-widget-header", snapMode: "outer"});
                $("#relacion1").draggable({snap: ".ui-widget-header", snapMode: "outer"});
            });

            function posicionObjeto(idObjeto) {
                /*// capturar la posicion del elemento por atributo de css
                var x = document.getElementById("relacion1").getAttribute("style");
                var largoEstilo = x.length;*/

                // capturar la posicion del elemento por atributo de css
                var objeto = document.getElementById(idObjeto);
                var x = objeto.offsetLeft;
                var y = objeto.offsetTop;
                //alert(x + " - " + y);
                return [x, y];

                /*// capturar la posicion del elemento por las coordenadas x y
                var offsets = document.getElementById("relacion1").getBoundingClientRect();
                var top = offsets.top;
                var left = offsets.left;
                alert(top + " - " + left);*/
            }

            function validarPosicionRelacion(idRelacion, Entidades) {
                var largoEntidades = Entidades.length;

                for(i = 0; i < largoEntidades; i++) {
                    var entidad = posicionObjeto(Entidades[i]);
                    var xEntidad = entidad[0];
                    var yEntidad = entidad[1];

                    var relacion = posicionObjeto(idRelacion);
                    var xRelacion = relacion[0];
                    var yRelacion = relacion[1];

                    var minXIzquierda = xRelacion-110-130;
                    var maxXIzquierda = xRelacion-80-130;
                    var minXDerecha = xRelacion+110+130;
                    var maxXDerecha = xRelacion+80+130;
                    var minAlto = yRelacion-20;
                    var maxAlto = yRelacion+20;

                    var divHijo = document.getElementById(Entidades[i]).childNodes[1];

                    if((xEntidad >= minXIzquierda && xEntidad <= maxXIzquierda) ||
                            (xEntidad <= minXDerecha && xEntidad >= maxXDerecha)) {
                        if(yEntidad >= minAlto && yEntidad <= maxAlto) {
                            divHijo.style.backgroundColor = "green";
                            //var mensaje = "Ok";
                        }
                        else {
                            divHijo.style.backgroundColor = "#e95420";
                            //var mensaje = "Negativo central";
                        }
                    }
                    else {
                        divHijo.style.backgroundColor = "#e95420";
                        //var mensaje = "Negativo central";
                    }
                }
            }

            function guardarPosicionEntidad(ladoIzquierdo, ladoDerecho) {
                if(ladoIzquierdo === undefined) {
                    ladoIzquierdo = "false";
                }
                if(ladoDerecho === undefined) {
                    ladoDerecho = "false";
                }
                sessionStorage.setItem("ladoIzquierdo", ladoIzquierdo);
                sessionStorage.setItem("ladoDerecho", ladoDerecho);
            }

            function validarPosicionEntidad(idRelacion, idEntidad) {
                var entidad = posicionObjeto(idEntidad);
                var xEntidad = entidad[0];
                var yEntidad = entidad[1];

                var relacion = posicionObjeto(idRelacion);
                var xRelacion = relacion[0];
                var yRelacion = relacion[1];

                var minXIzquierda = xRelacion-110-130;
                var maxXIzquierda = xRelacion-80-130;
                var minXDerecha = xRelacion+110+130;
                var maxXDerecha = xRelacion+80+130;
                var minAlto = yRelacion-20;
                var maxAlto = yRelacion+20;

                var divHijo = document.getElementById(idEntidad).childNodes[1];

                if((xEntidad >= minXIzquierda && xEntidad <= maxXIzquierda) ||
                        (xEntidad <= minXDerecha && xEntidad >= maxXDerecha)) {
                    if(yEntidad >= minAlto && yEntidad <= maxAlto) {
                        divHijo.style.backgroundColor = "green";
                        //var mensaje = "Ok";
                    }
                    else {
                        divHijo.style.backgroundColor = "#e95420";
                        //var mensaje = "Negativo central";
                    }
                }
                else {
                    divHijo.style.backgroundColor = "#e95420";
                    //var mensaje = "Negativo central";
                }

                //alert(mensaje);
            }
        </script>
        <title>A practicar</title>
    </head>
    <body>
        <!-- <button onclick="validarPosicionObjeto('relacion1', 'entidad2')">Posicion</button>-->
        <!-- header -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-nav">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Hamburguesa</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <div class="navbar-collapse">
                        <a class="navbar-brand" href="file:///C:/wamp64/www/ProyectoFinal/ProyectoFinal/2.html">e-MER</a>
                    </div>
                </div>
            </div>
        </nav>
        <!-- Columnas -->
        <div class="col-lg-2">
            <ul class="nav nav-pills nav-stacked">
                <li class="dropdown-menu"><a href="">Nombre ejercicio</a></li>

                <li>
                    <button type="button" class="btn btn-primary btn-group-justified" data-container="body" data-toggle="popover" data-placement="bottom"
                            data-content= "Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                            Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                            Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.Vivamus
                            sagittis lacus vel augue laoreet rutrum faucibus.
                            asdjhlkjahsdkjahsldkjhasjkdhaslkjjd
                            ashdkjashdlkjashdlkjashdkljahsldj.
                            aksjdhkasjhdlkasjhdlkasjshdlkasd.
                            asdlkasdlkhaslkdjhaskjdhlaskjdhjklas." data-original-title="" title="">Letra ejercicio</button>
                </li>
            </ul>
        </div>

        <div class="col-lg-2">
            <div id="snaptarget" class="ui-widget-header">
                <div class="form" align="left">
                    <div id="agregacion" class="draggable ui-widget-content">

                    </div>
                    <div id="entidad1" class="draggable ui-widget-content" onmousemove="validarPosicionEntidad('relacion1', this.id)">
                        <div id="entidad" title=""><br><input id="inputEnt" type="text" name="nombre" size="10" maxlength="15"></div>
                        <div id="lineaAtributo1"></div>
                    </div>
                </div>

                    <div id="entidad2" class="draggable ui-widget-content" onmousemove="validarPosicionEntidad('relacion1', this.id)">
                        <div id="entidad" title=""><br><input id="inputEnt" type="text" name="nombre" size="10" maxlength="15"></div>
                    </div>

                    <div id="entidad3" class="draggable ui-widget-content" onmousemove="validarPosicionEntidad('relacion1', this.id)">
                        <div id="entidad" title=""><br><input id="inputEnt" type="text" name="nombre" size="10" maxlength="15">
                            <div id="categorizacion"></div>
                            <div id="lineaCategorizacionIzq"></div>
                            <div id="lineaCategorizacionDer"></div>
                        </div>
                    </div>

                    <div id="entidad4" class="draggable ui-widget-content" onmousemove="validarPosicionEntidad('relacion1', this.id)">
                        <div id="entidad" title=""><br><input id="inputEnt" type="text" name="nombre" size="10" maxlength="15">
                            <div id="categorizacion"></div>
                            <div id="disjunta"></div>
                            <div id="lineaCategorizacionIzq"></div>
                            <div id="lineaCategorizacionDer"></div>

                        </div>
                    </div>
                    <div id="relacion1" class="draggable ui-widget-content" onmousemove="validarPosicionRelacion(this.id, ['entidad1','entidad2'])">
                        <div id="relacion" title=""><br><input id="inputRel" type="text" name="nombre" size="7" maxlength="15">
                            <div id="lineaEntidadDerecha"></div>
                            <div id="lineaEntidadIzquierda"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <script src="../js/bootstrap.js"></script>
        <script src="../js/app.js"></script>
    </body>
</html>
