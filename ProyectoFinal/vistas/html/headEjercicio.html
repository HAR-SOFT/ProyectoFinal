<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="vistas/css/bootstrap1.css">
    <link rel="stylesheet" href="vistas/css//bootstrap.min.css.map">
    <link rel="stylesheet" href="vistas/css/bootstrap.min.css">
    <link rel="stylesheet" href="vistas/css/formas.css">
    <script>
        function closeModal() {
            $('#source-modal').hide();
            $('.modal-backdrop').hide();
        }
    </script>
    <script src="vistas/js/jquery-1.11.1.js"></script>
    <script src="vistas/js/jquery-1.12.4.js"></script>
    <script src="vistas/js/jquery-ui.js"></script>
    <script src="vistas/js/bootstrap.js"></script>
    <script src="vistas/js/app.js"></script>
    <script src="vistas/js/custom.js"></script>
    <!-- Estilos necesarios para funcion draggable de Jquery -->
    <style>
    .draggable { width: 90px; height: 80px; padding: 0px; float: left; margin: 20px 20px 10px  40px; font-size: .9em; }
    .draggableAgregacion { width: 500px; height: 250px; padding: 5px; float: left; margin: 20px 20px 10px  40px; font-size: .9em; }
    .ui-widget-header p, .ui-widget-content input{ margin: 10px 0px 0px 0px; }
    #snaptarget { height: 600px; width: 1100px;}
    </style>
    <script>
    // Cada id que coloquemos en esta function se le va a asignar la propiedad draggable (movimiento)
    // Esto se define en el ID del "padre" o contenedor
    // Por ejemplo:
    // <div id="entidad1" class="draggable ui-widget-content">
    // <div id="entidad" title=""><br><input id="inputEnt" type="text" name="nombre" size="10" maxlength="15">
    // </div>
    // </div>
    $(function () {
        $("#agregacion").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#entidad1").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#entidad2").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#entidad3").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#entidad4").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#entidad5").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#categorizacionDrag").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#categorizacionDragTotalidad").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#categorizacionDisDrag").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#relacion1").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#relacion2").draggable({snap: ".ui-widget-header", snapMode: "outer"});
        $("#relacion3").draggable({snap: ".ui-widget-header", snapMode: "outer"});
    });

    function posicionObjeto(idObjeto) {
        /*// capturar la posicion del elemento por atributo de css
        var x = document.getElementById("relacion1").getAttribute("style");
        var largoEstilo = x.length;*/

        // capturar la posicion del elemento por atributo de css
        var objeto = document.getElementById(idObjeto);
        var idObjeto = objeto.getAttribute("id");
        
        var x = objeto.offsetLeft;
        var y = objeto.offsetTop;
        //alert(x + " - " + y);
        return [x, y];

        /*// capturar la posicion del elemento por las coordenadas x y
        var offsets = document.getElementById("relacion1").getBoundingClientRect();
        var top = offsets.top;
        var left = offsets.left;
        alert(top + " - " + left);*/
    }
    
    function validarEntidades(Entidades) {
        var largoEntidades = Entidades.length;
        var validacion = [];

        for(i = 0; i < largoEntidades; i++) {
            var divHijo = document.getElementById(Entidades[i]).childNodes[1];
            validacion.push((divHijo.style.backgroundColor === "green").toString());
        }
        
        if(validacion.indexOf("false") !== -1) {
            alert("Las entidades no estÃ¡n correctamente relacionadas.");
        }
    }

    //valida posicion de relacion
    function validarPosicionRelacion(idRelacion, Entidades) {
        var largoEntidades = Entidades.length;

        for(i = 0; i < largoEntidades; i++) {
            var entidad = posicionObjeto(Entidades[i]);
            var xEntidad = entidad[0];
            var yEntidad = entidad[1];

            var relacion = posicionObjeto(idRelacion);
            var xRelacion = relacion[0];
            var yRelacion = relacion[1];

            var minXIzquierda = xRelacion-110-130;
            var maxXIzquierda = xRelacion-80-130;
            var minXDerecha = xRelacion+110+130;
            var maxXDerecha = xRelacion+80+130;
            var minAlto = yRelacion-20;
            var maxAlto = yRelacion+20;

            var divHijo = document.getElementById(Entidades[i]).childNodes[1];

            if((xEntidad >= minXIzquierda && xEntidad <= maxXIzquierda) ||
            (xEntidad <= minXDerecha && xEntidad >= maxXDerecha)) {
                if(yEntidad >= minAlto && yEntidad <= maxAlto) {
                    divHijo.style.backgroundColor = "green";
                    //var mensaje = "Ok";
                }
                else {
                    divHijo.style.backgroundColor = "#e95420";
                    //var mensaje = "Negativo central";
                }
            }
            else {
                divHijo.style.backgroundColor = "#e95420";
                //var mensaje = "Negativo central";
            }
        }
    }

    // valida posicion entidad
    // check de asosiado por id de relacion y entidades
    function validarPosicionEntidad(idRelacion, idEntidad) {
        //alert(idEntidad);
        var entidad = posicionObjeto(idEntidad);
        var xEntidad = entidad[0];
        var yEntidad = entidad[1];

        var relacion = posicionObjeto(idRelacion);
        var xRelacion = relacion[0];
        var yRelacion = relacion[1];

        var minXIzquierda = xRelacion-110-130;
        var maxXIzquierda = xRelacion-80-130;
        var minXDerecha = xRelacion+110+130;
        var maxXDerecha = xRelacion+80+130;
        var minAlto = yRelacion-20;
        var maxAlto = yRelacion+20;

        var divHijo = document.getElementById(idEntidad).childNodes[1];

        if((xEntidad >= minXIzquierda && xEntidad <= maxXIzquierda) ||
        (xEntidad <= minXDerecha && xEntidad >= maxXDerecha)) {
            if(yEntidad >= minAlto && yEntidad <= maxAlto) {
                divHijo.style.backgroundColor = "green";
                var validacion = true;
                //if(idEntidad.includes("entidad")) {
                //    guardarEntidades(idEntidad);
                //}
            }
            else {
                divHijo.style.backgroundColor = "#e95420";
                var validacion = false;
            }
        }
        else {
            divHijo.style.backgroundColor = "#e95420";
            var validacion = false;
        }

        //alert(mensaje);
    }
    </script>
    <title>A practicar</title>
</head>
